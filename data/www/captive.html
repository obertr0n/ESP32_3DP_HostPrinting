<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8" name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">

    <link rel="stylesheet" type="text/css" href="/www/captive.css">
    <!-- <link rel="stylesheet" type="text/css" href="captive.css"> -->
    <title>ESP32 HostPrint</title>
</head>

<body>
    <div id="container">
        <div id="wiftable">
            <table id="twifi">
                <thead id="twifihead">
                    <tr>
                        <th id="thssid" class="unselectable" unselectable="on">
                            <div id="refresh" onclick="refreshWifi()"> Refresh
                                <svg fill="#ffff" viewBox="0 0 24 24" width="1em" height="1em">
                                    <path
                                        d="M 7.1601562 3 L 8.7617188 5 L 19 5 L 19 15 L 16 15 L 20 20 L 24 15 L 21 15 L 21 3 L 7.1601562 3 z M 4 4 L 0 9 L 3 9 L 3 21 L 16.839844 21 L 15.238281 19 L 5 19 L 5 9 L 8 9 L 4 4 z" />
                                </svg>
                            </div>
                            <label>SSID</label>
                        </th>
                        <th id="thrssi" class="unselectable" unselectable="on">RSSI</th>
                        <th id="thtype" class="unselectable" unselectable="on">Type</th>
                        <th id="thchannel" class="unselectable" unselectable="on">Channel</th>
                    </tr>
                </thead>
                <tbody id="tbody"></tbody>
            </table>
        </div>
    </div>
    
<script>
    
    const tbwifi = document.getElementById('tbody');
    const twifi = document.getElementById('twifi');

    function refreshWifi() {
        var xhr = new XMLHttpRequest();
        xhr.open("GET", "/reqwifi?refresh", true);
        xhr.onreadystatechange = function () {
            if (this.readyState == 4 && this.status == 200) {
                json = JSON.parse(this.responseText);
                createWifList(json.networks, tbwifi);
                twifi.style.display = "table";
            }
        }
        xhr.send();
    }

    function connectTo(ssid)
    {

    }
    function createWifList(array, tbody) {
        // remove all the existing table data
        for (var i = tbody.rows.length - 1; i >= 0; i--) {
            tbody.deleteRow(i);
        }
        var body = "";
        for (var i = 0; i < array.length; i++) {

            body += "<tr id='filestr' onclick=\"connectTo('" + array[i].ssid + "')>";
            body += "<td id='tdssid'>" + array[i].ssid + "</td>";
            body += "<td id='tdrssi'>" + array[i].rssi + "</td>";
            body += "<td id='tdchan'>" + array[i].chan + "</td>";

            body += "<td id='tdtype'>" + getNetworkAuth(array[i].type) + "</td>";
            body += "</tr>";
        }
        tbody.innerHTML += body;
    }
    function getNetworkAuth(type)
    {
        var authType = "";
        switch(type)
        {
            case "0":
                authType = "Open";
                break;
            case "1":
                authType = "WEP";
                break;
            case "2":
                authType = "WPA_PSK";
                break;
            case "3":
                authType = "WPA2_PSK";
                break;
            case "4":
                authType = "WPA_WPA2_PSK";
                break;
            case "5":
                authType = "WPA2_ENTERPRISE";
                break;
            default:
                authType = "Unknown";
                break;
        }
        return authType;
    }
</script>
</body>


</html>